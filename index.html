<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>一次関数の理解ツール（4分割）</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: #f3f4f6;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 4px;
      height: 100vh;
      padding: 4px;
    }
    .panel {
      display: flex;
      flex-direction: column;
      background: #fff;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      overflow: hidden;
      min-width: 0;
      min-height: 0;
    }
    .panel-header {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: #f9fafb;
      border-bottom: 1px solid #e5e7eb;
      font-size: 12px;
      color: #4b5563;
    }
    .dots { display: flex; gap: 4px; margin-right: 6px; }
    .dot { width: 8px; height: 8px; border-radius: 999px; }
    .dot.red { background: #f87171; }
    .dot.yellow { background: #fbbf24; }
    .dot.green { background: #34d399; }
    .panel-title { font-weight: 600; font-size: 12px; color: #374151; }
    .panel-body {
      flex: 1;
      padding: 10px;
      overflow: auto;
      font-size: 14px;
      color: #111827;
    }
    h2 { margin: 0 0 8px; font-size: 16px; }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
    }
    .control-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .control-row label { min-width: 40px; }
    .control-row input[type="range"] {
      flex: 1;
    }
    .control-row input[type="number"] {
      width: 70px;
      padding: 4px 6px;
      font-size: 12px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
    }

    .formula-box, .explain-box, .table-box, .log-box {
      border-radius: 4px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 8px;
      font-size: 13px;
      white-space: pre-wrap;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 4px 6px;
      text-align: right;
    }
    th { background: #f3f4f6; }

    canvas {
      width: 100%;
      height: 100%;
      background: #ffffff;
      border-radius: 4px;
      border: 1px solid #e5e7eb;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(4, minmax(160px, 1fr));
        height: auto;
      }
    }
  </style>
</head>
<body>
  <div class="grid">
    <!-- 左上：グラフ -->
    <div class="panel">
      <div class="panel-header">
        <div class="dots">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>
        <span class="panel-title">一次関数のグラフ</span>
      </div>
      <div class="panel-body">
        <h2>グラフ</h2>
        <canvas id="graphCanvas"></canvas>
      </div>
    </div>

    <!-- 右上：パラメータ -->
    <div class="panel">
      <div class="panel-header">
        <div class="dots">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>
        <span class="panel-title">傾きと切片の操作</span>
      </div>
      <div class="panel-body">
        <h2>パラメータ</h2>
        <div class="controls">
          <div class="control-row">
            <label for="aRange">a（傾き）</label>
            <input id="aRange" type="range" min="-5" max="5" step="0.5" value="1" />
            <input id="aInput" type="number" step="0.5" value="1" />
          </div>
          <div class="control-row">
            <label for="bRange">b（切片）</label>
            <input id="bRange" type="range" min="-5" max="5" step="1" value="0" />
            <input id="bInput" type="number" step="1" value="0" />
          </div>
        </div>
      </div>
    </div>

    <!-- 左下：数式と説明 -->
    <div class="panel">
      <div class="panel-header">
        <div class="dots">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>
        <span class="panel-title">式と意味の説明</span>
      </div>
      <div class="panel-body">
        <h2>式と意味</h2>
        <div class="formula-box" id="formulaBox"></div>
        <div style="margin-top:8px;" class="explain-box" id="explainBox"></div>
      </div>
    </div>

    <!-- 右下：値の表とログ -->
    <div class="panel">
      <div class="panel-header">
        <div class="dots">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>
        <span class="panel-title">値の表と操作履歴</span>
      </div>
      <div class="panel-body">
        <h2>値の表</h2>
        <div class="table-box" id="tableBox"></div>
        <h2 style="margin-top:10px;">ログ</h2>
        <div class="log-box" id="logBox"></div>
      </div>
    </div>
  </div>

  <script>
    const aRange = document.getElementById('aRange');
    const bRange = document.getElementById('bRange');
    const aInput = document.getElementById('aInput');
    const bInput = document.getElementById('bInput');
    const formulaBox = document.getElementById('formulaBox');
    const explainBox = document.getElementById('explainBox');
    const tableBox = document.getElementById('tableBox');
    const logBox = document.getElementById('logBox');
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * window.devicePixelRatio;
      canvas.height = rect.height * window.devicePixelRatio;
      ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
    }

    window.addEventListener('resize', () => {
      resizeCanvas();
      draw();
    });

    function formatFormula(a, b) {
      const aStr = (a === 1) ? '' : (a === -1 ? '-' : a);
      let bStr = '';
      if (b > 0) bStr = ' + ' + b;
      else if (b < 0) bStr = ' - ' + Math.abs(b);
      return `y = ${aStr}x${bStr || ''}`;
    }

    function updateUI() {
      const a = Number(aInput.value);
      const b = Number(bInput.value);

      // 数式
      formulaBox.textContent = `現在の式：${formatFormula(a, b)}`;

      // 説明
      const y0 = b;
      const y1 = a + b;
      explainBox.textContent =
        `・a（傾き）は「xが1増えたときにyがどれだけ増えるか」を表します。\n` +
        `・b（切片）は「x=0のときのyの値」です。\n\n` +
        `例：x=0 のとき y=${y0}\n` +
        `　　x=1 のとき y=${y1}\n` +
        `　　→ xが1増えると yは ${a} だけ変化します。`;

      // 表
      const xs = [];
      for (let x = -5; x <= 5; x++) xs.push(x);
      let html = '<table><thead><tr><th>x</th><th>y</th></tr></thead><tbody>';
      xs.forEach(x => {
        const y = a * x + b;
        html += `<tr><td>${x}</td><td>${y}</td></tr>`;
      });
      html += '</tbody></table>';
      tableBox.innerHTML = html;

      // ログ
      const now = new Date().toLocaleTimeString();
      const line = `[${now}] a=${a}, b=${b} → ${formatFormula(a,b)}`;
      logBox.textContent = line + '\n' + logBox.textContent;

      // グラフ
      draw();
    }

    function drawAxes(xMin, xMax, yMin, yMax) {
      const w = canvas.width / window.devicePixelRatio;
      const h = canvas.height / window.devicePixelRatio;
      ctx.clearRect(0, 0, w, h);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, w, h);

      function toScreenX(x) {
        return (x - xMin) / (xMax - xMin) * w;
      }
      function toScreenY(y) {
        return h - (y - yMin) / (yMax - yMin) * h;
      }

      // グリッド
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      for (let x = Math.ceil(xMin); x <= xMax; x++) {
        const sx = toScreenX(x);
        ctx.beginPath();
        ctx.moveTo(sx, 0);
        ctx.lineTo(sx, h);
        ctx.stroke();
      }
      for (let y = Math.ceil(yMin); y <= yMax; y++) {
        const sy = toScreenY(y);
        ctx.beginPath();
        ctx.moveTo(0, sy);
        ctx.lineTo(w, sy);
        ctx.stroke();
      }

      // x軸, y軸
      ctx.strokeStyle = '#9ca3af';
      ctx.lineWidth = 1.5;
      // x軸
      const sx0 = toScreenY(0);
      ctx.beginPath();
      ctx.moveTo(0, sx0);
      ctx.lineTo(w, sx0);
      ctx.stroke();
      // y軸
      const sy0 = toScreenX(0);
      ctx.beginPath();
      ctx.moveTo(sy0, 0);
      ctx.lineTo(sy0, h);
      ctx.stroke();

      return { toScreenX, toScreenY };
    }

    function draw() {
      const a = Number(aInput.value);
      const b = Number(bInput.value);
      const xMin = -5, xMax = 5;
      const yMin = -5, yMax = 5;

      const { toScreenX, toScreenY } = drawAxes(xMin, xMax, yMin, yMax);

      // 直線
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 2;
      const x1 = xMin, x2 = xMax;
      const y1 = a * x1 + b;
      const y2 = a * x2 + b;
      ctx.beginPath();
      ctx.moveTo(toScreenX(x1), toScreenY(y1));
      ctx.lineTo(toScreenX(x2), toScreenY(y2));
      ctx.stroke();

      // 重要な2点（x=0,1）
      const points = [
        { x: 0, y: b },
        { x: 1, y: a + b }
      ];
      ctx.fillStyle = '#ef4444';
      points.forEach(p => {
        const sx = toScreenX(p.x);
        const sy = toScreenY(p.y);
        ctx.beginPath();
        ctx.arc(sx, sy, 4, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function syncFromRange() {
      aInput.value = aRange.value;
      bInput.value = bRange.value;
      updateUI();
    }

    function syncFromInput() {
      aRange.value = aInput.value;
      bRange.value = bInput.value;
      updateUI();
    }

    aRange.addEventListener('input', syncFromRange);
    bRange.addEventListener('input', syncFromRange);
    aInput.addEventListener('change', syncFromInput);
    bInput.addEventListener('change', syncFromInput);

    // 初期化
    resizeCanvas();
    updateUI();
  </script>
</body>
</html>